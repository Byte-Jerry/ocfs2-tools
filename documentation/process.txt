Processes
---------

Q01	List and describe all OCFS2 threads?
A01	[o2net]
	One per node. Is a workqueue thread started when the cluster is
	brought online and stopped when offline. It handles the network
	communication for all threads. It gets the list of active nodes
	from the o2hb thread and sets up tcp/ip communication channels
	with each active node. It sends regular keepalive packets to
	detect any interruption on the channels.

	[user_dlm]
	One per node. Is a workqueue thread started when dlmfs is loaded and
	stopped on unload. (dlmfs is an in-memory file system which allows user
	space processes to access the dlm in kernel to lock and unlock
	resources.) Handles lock downconverts when requested by other
	nodes.

	[ocfs2_wq]
	One per node. Is a workqueue thread started when ocfs2 module is
	loaded and stopped on unload. Handles blockable file system tasks
	like truncate log flush, orphan dir recovery and local alloc
	recovery, which involve taking dlm locks. Various code paths
	queue tasks to this thread. For example, ocfs2rec queues orphan
	dir recovery so that while the task is kicked off as part of
	recovery, its completion does not affect the recovery time.

	[o2hb-14C29A7392]
	One per heartbeat device. Is a kernel thread started when the
	heartbeat region is populated in configfs and stopped when it
	is removed. It writes every 2 secs to its block in the heartbeat
	region to indicate to other nodes that that node is alive. It also
	reads the region to maintain a nodemap of live nodes. It notifies
	o2net and dlm any changes in the nodemap.

	[ocfs2vote-0]
	One per mount. Is a kernel thread started when a volume is mounted
	and stopped on umount. It downgrades locks when requested by other
	nodes in reponse to blocking ASTs (BASTs). It also fixes up the dentry
	cache in reponse to files unlinked or renamed on other nodes.

	[dlm_thread]
	One per dlm domain. Is a kernel thread started when a dlm domain
	is created and stopped when destroyed. This is the core dlm
	which maintains the list of lock resources and handles the
	cluster locking infrastructure.

	[dlm_reco_thread]
	One per dlm domain. Is a kernel thread which handles dlm recovery
	whenever a node dies. If the node is the dlm recovery master, it
	remasters all the locks owned by the dead node.

	[dlm_wq]
	One per dlm domain. Is a workqueue thread. o2net queues dlm
	tasks on this thread.

	[kjournald]
	One per mount. Is used as OCFS2 uses JDB for journalling.

	[ocfs2cmt-0]
	One per mount. Is a kernel thread started when a volume is
	mounted and stooped on umount. Works in conjunction with
	kjournald.

	[ocfs2rec-0]
	Is started whenever another node needs to be be recovered. This
	could be either on mount when it discovers a dirty journal or
	during operation when hb detects a dead node. ocfs2rec handles
	the file system recovery and it runs after the dlm has finished
	its recovery.
